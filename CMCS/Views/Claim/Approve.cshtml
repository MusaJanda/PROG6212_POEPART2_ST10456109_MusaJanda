@model CMCS.Models.Claim

@{
    ViewData["Title"] = "Approve Claim";
    var isProgrammeCoordinator = User.IsInRole("ProgrammeCoordinator");
    var isAcademicManager = User.IsInRole("AcademicManager");
}

<div class="container mt-4">
    <h1>Review Claim</h1>
    <hr />

    <div class="card mb-4">
        <div class="card-header">
            <h5>Claim Information</h5>
        </div>
        <div class="card-body">
            <dl class="row">
                <dt class="col-sm-3">Lecturer:</dt>
                <dd class="col-sm-9">@Model.Lecturer?.FirstName @Model.Lecturer?.LastName</dd>

                <dt class="col-sm-3">Claim Date:</dt>
                <dd class="col-sm-9">@Model.ClaimDate.ToShortDateString()</dd>

                <dt class="col-sm-3">Hours Worked:</dt>
                <dd class="col-sm-9">@Model.HoursWorked</dd>

                <dt class="col-sm-3">Hourly Rate:</dt>
                <dd class="col-sm-9">@Model.HourlyRate.ToString("C")</dd>

                <dt class="col-sm-3">Total Amount:</dt>
                <dd class="col-sm-9">@((Model.HoursWorked * Model.HourlyRate).ToString("C"))</dd>

                <dt class="col-sm-3">Description:</dt>
                <dd class="col-sm-9">@Model.Description</dd>

                <dt class="col-sm-3">Current Status:</dt>
                <dd class="col-sm-9">
                    <span class="badge bg-info">@Model.Status</span>
                </dd>
            </dl>
        </div>
    </div>

    @if (isProgrammeCoordinator)
    {
        <form asp-action="ApproveByCoordinator" method="post">
            <input type="hidden" name="id" value="@Model.ClaimId" />

            <div class="form-group mb-3">
                <label for="coordinatorNotes" class="form-label">Notes (required if rejecting):</label>
                <textarea name="coordinatorNotes" class="form-control" rows="3"></textarea>
            </div>

            <div class="form-group">
                <button type="submit" name="isApproved" value="true" class="btn btn-success me-2">Approve</button>
                <button type="submit" name="isApproved" value="false" class="btn btn-danger">Reject</button>
                <a asp-action="Index" asp-controller="Dashboard" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    }

    @if (isAcademicManager)
    {
        <form asp-action="ApproveByManager" method="post">
            <input type="hidden" name="id" value="@Model.ClaimId" />

            <div class="form-group mb-3">
                <label for="managerNotes" class="form-label">Notes (required if rejecting):</label>
                <textarea name="managerNotes" class="form-control" rows="3"></textarea>
            </div>

            <div class="form-group">
                <button type="submit" name="isApproved" value="true" class="btn btn-success me-2">Approve</button>
                <button type="submit" name="isApproved" value="false" class="btn btn-danger">Reject</button>
                <a asp-action="Index" asp-controller="Dashboard" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    }
</div>